<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Arkanoid | Neon Sultan</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <style>
    body {
      background: radial-gradient(ellipse at 60% 15%, #495082 0%, #181924 100%);
      min-height: 100vh;
    }
    .arkanoid-container { display:flex; flex-direction:column; align-items:center; margin-top:48px;}
    #arkanoidCanvas {
      background: #181924;
      border:3px solid #eee;
      border-radius:18px;
      margin-top:24px;
      max-width:100vw;
      box-shadow: 0 10px 40px #000a, 0 1.5px 0.5px #61dafb44;
      transition: box-shadow 0.25s;
      touch-action: manipulation;
      display: block;
    }
    .arkanoid-score { color:#61dafb; font-size:1.2em; margin-top:16px; text-shadow: 0 2px 8px #222b;}
    .arkanoid-btn { margin-top:18px; padding:10px 24px; font-size:1em; border-radius:11px; border:none; background:linear-gradient(90deg,#61dafb,#fbbd23); color:#222; font-weight:bold; cursor:pointer; transition:all .2s;}
    .arkanoid-btn:hover { background:linear-gradient(90deg,#fbbd23,#61dafb); color:#fff; transform: translateY(-2px) scale(1.055);}
    .arkanoid-level { color: #fbbd23; font-size: 1.1em; margin-top: 14px; text-shadow: 0 2px 8px #222a;}
    /* Зоны управления */
    .arkanoid-touch-zones {
      display: none;
      width: 98vw;
      max-width: 480px;
      margin: 14px auto 0;
      height: 60px;
      position: relative;
      user-select: none;
      -webkit-user-select: none;
      z-index: 9;
    }
    .arkanoid-touch-zone {
      width: 50%;
      height: 100%;
      position: absolute;
      top: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5em;
      color: #222;
      opacity: 0.89;
      background: linear-gradient(90deg,#61dafb33,#fbbd2333);
      border-radius: 16px;
      transition: background .18s;
      cursor: pointer;
      touch-action: manipulation;
    }
    .arkanoid-touch-zone.left { left: 0; }
    .arkanoid-touch-zone.right { right: 0; }
    .arkanoid-touch-zone:active, .arkanoid-touch-zone.active {
      background: linear-gradient(90deg,#fbbd23cc,#61dafbcc);
      color: #181924;
      opacity: 1;
    }
    .arkanoid-fullscreen-btn {
      margin-top: 16px;
      padding: 10px 24px;
      font-size: 1.1em;
      border-radius: 10px;
      border: none;
      background: #181924;
      color: #61dafb;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 8px #222b44;
      transition: background .2s, color .2s;
      width: 100%;
      max-width: 340px;
    }
    .arkanoid-fullscreen-btn:active, .arkanoid-fullscreen-btn:focus {
      background: #61dafb;
      color: #181924;
      outline: 2px solid #ffd600;
    }
    @media (max-width: 600px) {
      .arkanoid-container { padding: 8px 2px; margin-top:6vw; }
      #arkanoidCanvas { width: 98vw !important; height: 60vw !important; max-width:98vw; max-height:65vw;}
      .arkanoid-btn { padding: 12px 0; width: 100%; font-size: 1.1em; }
      .arkanoid-touch-zones { display:flex; }
      .arkanoid-fullscreen-btn { font-size: 1.2em; }
    }
  </style>
</head>
<body>
  <nav class="navbar modern-navbar">
    <div class="container">
      <div class="logo">Neon Sultan</div>
      <ul class="nav-links" id="navLinks">
        <li><a href="../index.html">Ana Səhifə</a></li>
        <li><a href="../about.html">Haqqımda</a></li>
        <li><a href="../projects.html">Proyektlərim</a></li>
        <li><a href="../license.html">Lisenziya</a></li>
        <li><a href="../contact.html">Əlaqə</a></li>
        <li><a href="../oyunlar.html" class="active">Oyunlar</a></li>
      </ul>
    </div>
  </nav>
  <main class="container arkanoid-container" id="arkanoidMain">
    <h1 style="text-shadow:0 4px 16px #61dafb33;">Arkanoid</h1>
    <div class="arkanoid-level" id="arkanoidLevel">Səviyyə: 1</div>
    <canvas id="arkanoidCanvas" width="480" height="320"></canvas>
    <div class="arkanoid-score" id="arkanoidScore">Xal: 0</div>
    <button class="arkanoid-btn" onclick="arkanoidStart()" aria-label="Yenidən başla">Yenidən başla</button>
    <button class="arkanoid-fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()" aria-label="Tam ekran rejimi">⛶ Tam ekran</button>
    <div class="arkanoid-touch-zones" id="arkanoidTouchZones">
      <div class="arkanoid-touch-zone left" id="zoneLeft" aria-label="Sola sür"></div>
      <div class="arkanoid-touch-zone right" id="zoneRight" aria-label="Sağa sür"></div>
    </div>
    <a href="../oyunlar.html" class="arkanoid-btn" style="background:#222; color:#fff; margin-top:12px;">← Oyunlara qayıt</a>
  </main>
  <footer class="footer">
    <p>© 2025 Sultan. Neon Group Azerbaijan | <a href="../license.html">Lisenziya</a></p>
  </footer>
  <script>
    // === Arkanoid с уровнями и плавным управлением ===
    const canvas = document.getElementById("arkanoidCanvas");
    const ctx = canvas.getContext("2d");
    // Список рандомных уровней (разные цвета, ряды/столбцы, формы)
    function makeRandomLevel() {
      // Цвета — яркие и разные на каждый уровень
      function randColor() {
        const h = Math.floor(Math.random()*360);
        return `hsl(${h},92%,60%)`;
      }
      const forms = ["rect","circle"];
      const rows = 4 + Math.floor(Math.random()*4); // 4-7
      const cols = 6 + Math.floor(Math.random()*5); // 6-10
      const gap = 6 + Math.floor(Math.random()*5);  // 6-10
      const brickShape = forms[Math.floor(Math.random()*forms.length)];
      const brickColor = randColor();
      const paddle = randColor();
      const ball = randColor();
      // случайные пустоты
      let mask = [];
      for(let c=0;c<cols;c++) {
        mask[c] = [];
        for(let r=0;r<rows;r++) mask[c][r] = Math.random()>0.15?1:0;
      }
      return {bg:"#181924",brickColor,paddle,ball,rows,cols,gap,brickShape,mask};
    }
    // Всего 7 рандомных + 3 фиксированных уровня
    const LEVELS = [
      makeRandomLevel(),
      makeRandomLevel(),
      makeRandomLevel(),
      makeRandomLevel(),
      makeRandomLevel(),
      makeRandomLevel(),
      makeRandomLevel(),
      {bg:"#232b3d", brickColor:"#fbbd23", paddle:"#fff", ball:"#61dafb", rows:5,cols:8,gap:9, brickShape:"rect"},
      {bg:"#3e2723", brickColor:"#ffd600", paddle:"#00e676", ball:"#00bcd4", rows:5,cols:9,gap:8, brickShape:"rect"},
      {bg:"#1a237e", brickColor:"#e91e63", paddle:"#ffd600", ball:"#fff", rows:6,cols:10,gap:6, brickShape:"circle"},
    ];

    const brickWidth = 40;
    const brickHeight = 16;
    const brickOffsetTop = 34;
    const brickOffsetLeft = 13;
    const paddleWidth = 80, paddleHeight = 14, paddleMargin = 10;
    const ballRadius = 9;

    let level, paddleX, ballX, ballY, ballDX, ballDY, bricks, score, running, animationFrame, totalScore;

    function arkanoidStart() {
      level = 1;
      totalScore = 0;
      startLevel(level);
    }

    function startLevel(lvl) {
      // Level params
      const L = LEVELS[lvl-1];
      document.getElementById("arkanoidLevel").textContent = "Səviyyə: " + lvl;
      canvas.style.background = L.bg;
      paddleX = (canvas.width - paddleWidth) / 2;
      ballX = canvas.width / 2;
      ballY = canvas.height - 42;
      ballDX = 3 * (Math.random() > 0.5 ? 1 : -1);
      ballDY = -3 - 0.19 * (lvl-1);
      bricks = [];
      for (let c = 0; c < L.cols; c++) {
        bricks[c] = [];
        for (let r = 0; r < L.rows; r++) {
          let isBrick = 1;
          if (L.mask) isBrick = L.mask[c][r]; // mask — для рандомных уровней
          bricks[c][r] = { x: 0, y: 0, status: isBrick, shade: Math.random() };
        }
      }
      score = 0;
      running = true;
      if (animationFrame) cancelAnimationFrame(animationFrame);
      draw();
    }

    function drawBricks() {
      const L = LEVELS[level-1];
      for (let c = 0; c < L.cols; c++) {
        for (let r = 0; r < L.rows; r++) {
          if (bricks[c][r].status === 1) {
            const gap = L.gap;
            const x = c * (brickWidth + gap) + brickOffsetLeft;
            const y = r * (brickHeight + gap) + brickOffsetTop;
            bricks[c][r].x = x;
            bricks[c][r].y = y;
            ctx.save();
            // 3D/glossy effect + яркий цвет
            if(L.brickShape === "rect") {
              const grad = ctx.createLinearGradient(x, y, x, y+brickHeight);
              grad.addColorStop(0, L.brickColor);
              grad.addColorStop(1, shadeColor(L.brickColor, -25));
              ctx.fillStyle = grad;
              ctx.shadowColor = L.brickColor;
              ctx.shadowBlur = 10;
              ctx.fillRect(x, y, brickWidth, brickHeight);
              ctx.globalAlpha = 0.36;
              ctx.fillStyle = "#fff";
              ctx.fillRect(x+3, y+3, brickWidth-6, 6);
              ctx.globalAlpha = 1;
              ctx.shadowBlur = 0;
              ctx.strokeStyle = "#222";
              ctx.lineWidth = 1.2;
              ctx.strokeRect(x, y, brickWidth, brickHeight);
            } else {
              // 3D neon glowing circle
              ctx.save();
              ctx.shadowColor = L.brickColor;
              ctx.shadowBlur = 24;
              ctx.beginPath();
              ctx.arc(x+brickWidth/2, y+brickHeight/2, Math.min(brickWidth, brickHeight)/2, 0, 2*Math.PI);
              ctx.fillStyle = L.brickColor;
              ctx.globalAlpha = 0.82;
              ctx.fill();
              ctx.globalAlpha = 1;
              ctx.shadowBlur = 0;
              ctx.beginPath();
              ctx.arc(x+brickWidth/2, y+brickHeight/2, Math.min(brickWidth, brickHeight)/2-2, Math.PI*0.93, Math.PI*2.16);
              ctx.strokeStyle = "#fff8";
              ctx.lineWidth = 3;
              ctx.stroke();
              ctx.restore();
            }
            ctx.restore();
          }
        }
      }
    }

    function drawPaddle() {
      const L = LEVELS[level-1];
      ctx.save();
      ctx.shadowColor = "#fff";
      ctx.shadowBlur = 20;
      let grad = ctx.createLinearGradient(paddleX,canvas.height-paddleHeight-paddleMargin,paddleX+paddleWidth,canvas.height-paddleHeight-paddleMargin+paddleHeight);
      grad.addColorStop(0,shadeColor(L.paddle,-5));
      grad.addColorStop(0.45,L.paddle);
      grad.addColorStop(1,shadeColor(L.paddle,22));
      ctx.fillStyle = grad;
      roundRect(ctx, paddleX, canvas.height-paddleHeight-paddleMargin, paddleWidth, paddleHeight, 8, true, false);
      ctx.shadowBlur = 0;
      ctx.globalAlpha = 0.22;
      ctx.fillStyle = "#fff";
      roundRect(ctx, paddleX+9, canvas.height-paddleHeight-paddleMargin+3, paddleWidth-18, 4, 2, true, false);
      ctx.globalAlpha = 1;
      ctx.restore();
    }

    function drawBall() {
      const L = LEVELS[level-1];
      ctx.save();
      ctx.shadowColor = L.ball;
      ctx.shadowBlur = 20;
      ctx.beginPath();
      ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
      ctx.fillStyle = L.ball;
      ctx.fill();
      ctx.shadowBlur = 0;
      ctx.globalAlpha = 0.5;
      ctx.beginPath();
      ctx.arc(ballX-4, ballY-4, ballRadius/2, Math.PI*1.4, Math.PI*1.9);
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 3;
      ctx.stroke();
      ctx.globalAlpha = 1;
      ctx.restore();
    }

    function drawScore() {
      document.getElementById("arkanoidScore").textContent = "Xal: " + (totalScore + score);
    }

    function collisionDetection() {
      const L = LEVELS[level-1];
      for (let c = 0; c < L.cols; c++) {
        for (let r = 0; r < L.rows; r++) {
          const b = bricks[c][r];
          if (b.status === 1) {
            if (
              ballX > b.x &&
              ballX < b.x + brickWidth &&
              ballY - ballRadius > b.y &&
              ballY - ballRadius < b.y + brickHeight
            ) {
              ballDY = -ballDY;
              b.status = 0;
              score += 10 * level;
              if (isWin()) {
                totalScore += score;
                if (level < LEVELS.length) {
                  showLevelComplete();
                  setTimeout(()=>startLevel(level+1), 1200);
                  level++;
                } else {
                  document.getElementById("arkanoidScore").textContent = "Təbriklər! Bütün səviyyələri keçdin! Ümumi xal: " + (totalScore + score);
                  running = false;
                }
              }
            }
          }
        }
      }
    }

    function isWin() {
      const L = LEVELS[level-1];
      for (let c = 0; c < L.cols; c++)
        for (let r = 0; r < L.rows; r++)
          if (bricks[c][r].status === 1) return false;
      return true;
    }

    function showLevelComplete() {
      ctx.save();
      ctx.globalAlpha = 0.84;
      ctx.fillStyle = "#161a2d";
      ctx.fillRect(0, canvas.height/2-36, canvas.width, 72);
      ctx.globalAlpha = 1;
      ctx.fillStyle = "#61dafb";
      ctx.font = "bold 30px 'Inter', Arial";
      ctx.textAlign = "center";
      ctx.shadowColor = "#fbbd23";
      ctx.shadowBlur = 16;
      ctx.fillText("Səviyyə tamamlandı!", canvas.width/2, canvas.height/2+10);
      ctx.shadowBlur = 0;
      ctx.restore();
    }

    function draw() {
      const L = LEVELS[level-1];
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawBricks();
      drawPaddle();
      drawBall();
      drawScore();

      if (!running) return;

      // Ball movement
      ballX += ballDX;
      ballY += ballDY;

      // Collision with walls
      if (ballX + ballRadius > canvas.width || ballX - ballRadius < 0) ballDX = -ballDX;
      if (ballY - ballRadius < 0) ballDY = -ballDY;

      // Paddle collision
      if (
        ballY + ballRadius > canvas.height - paddleHeight - paddleMargin &&
        ballX > paddleX &&
        ballX < paddleX + paddleWidth
      ) {
        ballDY = -Math.abs(ballDY);
        // Add effect: ballDX changes slightly depending on hit position
        const hitPoint = (ballX - (paddleX + paddleWidth / 2)) / (paddleWidth / 2);
        ballDX += hitPoint * 1.5;
        if (ballDX > 7) ballDX = 7;
        if (ballDX < -7) ballDX = -7;
      }

      // Bottom out
      if (ballY + ballRadius > canvas.height) {
        document.getElementById("arkanoidScore").textContent = "Oyun bitdi! Ümumi xal: " + (totalScore + score);
        running = false;
        return;
      }

      collisionDetection();

      animationFrame = requestAnimationFrame(draw);
    }

    // Paddle mouse control (PC)
    canvas.addEventListener("mousemove", function (e) {
      const rect = canvas.getBoundingClientRect();
      let mouseX = e.clientX - rect.left;
      paddleX = mouseX - paddleWidth / 2;
      if (paddleX < 0) paddleX = 0;
      if (paddleX + paddleWidth > canvas.width) paddleX = canvas.width - paddleWidth;
    });

    // Paddle keyboard control (PC)
    document.addEventListener("keydown", function (e) {
      if (!running) return;
      if (e.key === "ArrowLeft") {
        paddleX -= 40;
        if (paddleX < 0) paddleX = 0;
      } else if (e.key === "ArrowRight") {
        paddleX += 40;
        if (paddleX + paddleWidth > canvas.width) paddleX = canvas.width - paddleWidth;
      }
    });

    // ==== Быстрое плавное перемещение платформы на мобильных ====
    let moveLeft = false, moveRight = false, moveInterval = null;
    function startMove(dir) {
      if (!running) return;
      stopMove();
      if (dir === -1) moveLeft = true;
      if (dir === 1) moveRight = true;
      moveInterval = setInterval(() => {
        if (!running) return;
        if (moveLeft) {
          paddleX -= 9;
          if (paddleX < 0) paddleX = 0;
        }
        if (moveRight) {
          paddleX += 9;
          if (paddleX + paddleWidth > canvas.width) paddleX = canvas.width - paddleWidth;
        }
      }, 15);
    }
    function stopMove() {
      moveLeft = false;
      moveRight = false;
      if (moveInterval) clearInterval(moveInterval);
      moveInterval = null;
    }
    // Touch и mouse события для зон управления
    function setupTouchZones() {
      const left = document.getElementById('zoneLeft');
      const right = document.getElementById('zoneRight');
      // Touch events
      left.addEventListener('touchstart', e => { startMove(-1); left.classList.add('active'); e.preventDefault(); });
      left.addEventListener('touchend', e => { stopMove(); left.classList.remove('active'); });
      right.addEventListener('touchstart', e => { startMove(1); right.classList.add('active'); e.preventDefault(); });
      right.addEventListener('touchend', e => { stopMove(); right.classList.remove('active'); });
      // Mouse events (удержание мыши)
      left.addEventListener('mousedown', e => { startMove(-1); left.classList.add('active'); });
      left.addEventListener('mouseup', e => { stopMove(); left.classList.remove('active'); });
      left.addEventListener('mouseleave', e => { stopMove(); left.classList.remove('active'); });
      right.addEventListener('mousedown', e => { startMove(1); right.classList.add('active'); });
      right.addEventListener('mouseup', e => { stopMove(); right.classList.remove('active'); });
      right.addEventListener('mouseleave', e => { stopMove(); right.classList.remove('active'); });
    }
    setupTouchZones();

    // ==== Свайпы для мобильных + fullscreen вниз ====
    let touchStartX = 0, touchStartY = 0;
    canvas.addEventListener('touchstart', function(e) {
      if(e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }
    });
    canvas.addEventListener('touchend', function(e) {
      if(e.changedTouches.length === 1) {
        let dx = e.changedTouches[0].clientX - touchStartX;
        let dy = e.changedTouches[0].clientY - touchStartY;
        if(Math.abs(dx) > 24 || Math.abs(dy) > 24) {
          if(Math.abs(dx) > Math.abs(dy)) {
            if(dx > 0) startMove(1), setTimeout(stopMove, 100); // Right (быстрый рывок)
            else startMove(-1), setTimeout(stopMove, 100);     // Left  (быстрый рывок)
          } else {
            if(dy > 0) toggleFullscreen(); // Down — fullscreen
          }
        }
      }
    });

    // ==== Полноэкранный режим ====
    function toggleFullscreen() {
      const el = document.getElementById('arkanoidMain');
      if (!document.fullscreenElement && el.requestFullscreen) {
        el.requestFullscreen();
        setFullscreenBtn(true);
      } else if (document.exitFullscreen) {
        document.exitFullscreen();
        setFullscreenBtn(false);
      }
    }
    function setFullscreenBtn(full) {
      const btn = document.getElementById('fullscreenBtn');
      if(full || document.fullscreenElement){
        btn.textContent = '⛶ Tam ekrandan çıx';
        btn.setAttribute('aria-label','Tam ekrandan çıx');
      } else {
        btn.textContent = '⛶ Tam ekran';
        btn.setAttribute('aria-label','Tam ekran rejimi');
      }
    }
    document.addEventListener('fullscreenchange', () => {
      setFullscreenBtn(!!document.fullscreenElement);
      if(document.fullscreenElement) setTimeout(resizeCanvasMobile, 100);
      else setTimeout(resetCanvasSize, 100);
    });

    // ==== Canvas под размер экрана (мобильные) ====
    function resizeCanvasMobile() {
      if(window.innerWidth < 600) {
        canvas.width = window.innerWidth * 0.98;
        canvas.height = window.innerHeight * 0.62;
      }
    }
    function resetCanvasSize() {
      canvas.width = 480;
      canvas.height = 320;
    }
    function handleResize() {
      if(window.innerWidth < 600) {
        resizeCanvasMobile();
      } else {
        resetCanvasSize();
      }
    }
    window.addEventListener('resize', handleResize);

    // ==== Helpers ====
    function roundRect(ctx, x, y, w, h, r, fill, stroke) {
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.lineTo(x+w-r, y);
      ctx.quadraticCurveTo(x+w, y, x+w, y+r);
      ctx.lineTo(x+w, y+h-r);
      ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
      ctx.lineTo(x+r, y+h);
      ctx.quadraticCurveTo(x, y+h, x, y+h-r);
      ctx.lineTo(x, y+r);
      ctx.quadraticCurveTo(x, y, x+r, y);
      ctx.closePath();
      if (fill) ctx.fill();
      if (stroke) ctx.stroke();
    }
    function shadeColor(color, percent) {
      // HSL поддержка! для ярких цветов
      if(color.startsWith("hsl")) {
        let [h,s,l] = color.match(/\d+/g).map(Number);
        l = Math.max(0,Math.min(100,l+percent));
        return `hsl(${h},${s}%,${l}%)`;
      }
      color = color.replace('#','');
      let R = parseInt(color.substring(0,2),16);
      let G = parseInt(color.substring(2,4),16);
      let B = parseInt(color.substring(4,6),16);
      R = Math.min(255,Math.max(0,parseInt(R * (100+percent)/100)));
      G = Math.min(255,Math.max(0,parseInt(G * (100+percent)/100)));
      B = Math.min(255,Math.max(0,parseInt(B * (100+percent)/100)));
      return "#" + ("0"+R.toString(16)).slice(-2) + ("0"+G.toString(16)).slice(-2) + ("0"+B.toString(16)).slice(-2);
    }

    arkanoidStart();
    handleResize();
  </script>
</body>
</html>
