<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connect Four | Neon Sultan</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <style>
    body {background: radial-gradient(ellipse at 60% 15%, #22264a 0%, #181924 100%);}
    .c4-container {display:flex; flex-direction:column; align-items:center; margin-top:44px; background:rgba(24,25,36,.98); border-radius:19px; padding:36px 22px 32px 22px; box-shadow:0 10px 44px #000b; max-width:470px; margin:auto;}
    .c4-title {font-size:2em; color:#61dafb; margin-bottom:8px; text-shadow:0 2px 12px #222b;}
    .c4-mode-row {margin-bottom:13px; display:flex; gap:13px;}
    .c4-mode-btn {background:linear-gradient(90deg,#61dafb,#fbbd23); color:#222; border:none; border-radius:8px; font-weight:bold; font-size:1em; padding:7px 18px; cursor:pointer; box-shadow:0 2px 8px #0004; transition:.16s;}
    .c4-mode-btn.active, .c4-mode-btn:focus {background:linear-gradient(90deg,#fbbd23,#61dafb); color:#fff; outline:2px solid #fbbd23;}
    .c4-scores {display: flex; justify-content: space-between; width: 260px; color:#61dafb; font-size:1.18em; font-family: 'Inter', Arial, sans-serif; margin-bottom: 4px;}
    .c4-scores span {display:inline-block; min-width: 65px;}
    .c4-lang-select {margin:0 0 10px 0;}
    .c4-board {display:grid; grid-template-columns:repeat(7,48px); grid-template-rows:repeat(6,48px); gap:4px; margin-top:13px; background:#1a2240; border-radius:16px; box-shadow:0 7px 28px #0009;}
    .c4-cell {
      width:48px; height:48px; border-radius:50%;
      background:linear-gradient(135deg,#f5efdf 70%,#e5e1c1 100%);
      border:3px solid #2d3250;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; box-shadow:0 4px 18px #0007; transition:.12s;
      position: relative; overflow:hidden;
    }
    .c4-piece {
      width: 100%; height: 100%;
      border-radius: 50%;
      transition: transform 0.38s cubic-bezier(.39,1.01,.19,1.02);
      will-change: transform;
    }
    .c4-piece.r {
      background:radial-gradient(circle,#ff3377 60%,#b71c1c 100%);
      box-shadow:0 0 16px #e53935bb,0 4px 8px #b71c1c88;
      border:2.5px solid #fff;
    }
    .c4-piece.y {
      background:radial-gradient(circle,#ffe600 65%,#ffd000 100%);
      box-shadow:0 0 16px #ffe500bb,0 4px 8px #ffc10788;
      border:2.5px solid #fff;
    }
    .c4-cell.win .c4-piece {
      animation: c4-win-pulse 0.48s infinite alternate;
      outline: 4px solid #00e676;
      box-shadow:0 0 12px #00e676;
    }
    @keyframes c4-win-pulse {
      from { box-shadow: 0 0 12px #00e676, 0 0 0 #fff0; }
      to   { box-shadow: 0 0 28px #fbbd23dd, 0 0 14px #fff7; }
    }
    .c4-status {margin-top:13px; color:#fff; min-height:26px; font-size:1.08em; text-shadow:0 2px 8px #222a;}
    .c4-btn {margin-top:17px; padding:10px 26px; font-size:1em; border-radius:9px; border:none; background:linear-gradient(90deg,#61dafb,#fbbd23); color:#222; font-weight:bold; cursor:pointer; box-shadow:0 2px 10px #0006; transition:.2s;}
    .c4-btn:hover {background:linear-gradient(90deg,#fbbd23,#61dafb); color:#fff;}
    .c4-controls-mobile {
      display:none; margin-top:13px; width:100%; max-width:400px; flex-direction:column; align-items:center; gap:2px;
    }
    .c4-controls-row {display: flex; justify-content: center; gap: 12px; width: 100%;}
    .c4-controls-mobile button {
      background: #1c2060;
      color: #fbbd23;
      font-size: 1.8em;
      border: none;
      border-radius: 13px;
      width: 51px; height: 51px;
      margin: 1.5px 3px;
      box-shadow: 0 2px 10px #0007;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      touch-action: manipulation;
      transition: background .13s, color .13s;
    }
    .c4-controls-mobile button:active, .c4-controls-mobile button.active { background: #fbbd23; color: #23233b; }
    .c4-fullscreen-btn {
      margin-top: 10px;
      padding: 10px 24px;
      font-size: 1.1em;
      border-radius: 10px;
      border: none;
      background: #181924;
      color: #61dafb;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 8px #222b44;
      transition: background .2s, color .2s;
      width: 100%;
      max-width: 160px;
    }
    .c4-fullscreen-btn:active, .c4-fullscreen-btn:focus {
      background: #61dafb;
      color: #181924;
      outline: 2px solid #ffd600;
    }
    .c4-hint {
      position: absolute;
      left: 50%; top: 0; transform: translateX(-50%);
      font-size: 2.1em;
      color: #00e676;
      pointer-events:none;
      z-index: 3;
      animation: hint-pulse 1.1s infinite alternate;
      filter: drop-shadow(0 3px 7px #00e67644);
    }
    @keyframes hint-pulse {
      from { opacity: 0.6; }
      to { opacity: 1; }
    }
    .c4-avatar {
      width:28px; height:28px; border-radius:50%; object-fit:cover; vertical-align:middle; margin-right:6px;
      border:2px solid #fbbd23;background:#fff;
    }
    @media (max-width:600px) {
      .c4-container {padding:12px 2vw;}
      .c4-board {grid-template-columns:repeat(7,13vw); grid-template-rows:repeat(6,13vw);}
      .c4-cell {width:13vw; height:13vw;}
      .c4-controls-mobile{display:flex;}
      .c4-btn, .c4-fullscreen-btn {font-size:1.07em;}
      .c4-scores {width: 99vw;}
    }
  </style>
</head>
<body>
  <nav class="navbar modern-navbar"><div class="container"><div class="logo">Neon Sultan</div></div></nav>
  <main class="c4-container" id="c4Main">
    <div style="width:100%;display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <div class="c4-lang-select">
        <select id="langSelect" style="border-radius:7px;font-size:1em;padding:3px 12px;">
          <option value="az">üá¶üáø AZ</option>
          <option value="ru">üá∑üá∫ RU</option>
          <option value="en">üá¨üáß EN</option>
        </select>
      </div>
      <button class="c4-btn" id="btnScreenshot" style="margin:0;font-size:0.97em;padding:7px 14px;">üì∏</button>
    </div>
    <div class="c4-title">Connect Four</div>
    <div class="c4-mode-row">
      <button id="c4PVP" class="c4-mode-btn active" onclick="c4SetMode('pvp')">2 n…ôf…ôr</button>
      <button id="c4AI" class="c4-mode-btn" onclick="c4SetMode('ai')">NEON AI</button>
    </div>
    <div class="c4-scores" id="c4Scores">
      <span id="c4ScoreR">üî¥ 0</span>
      <span id="c4ScoreY">üü° 0</span>
    </div>
    <div id="c4Avatars" style="width: 230px; margin-bottom: 8px; display:flex; justify-content:space-between;">
      <span id="avatarRWrap"><img id="avatarR" class="c4-avatar" src="https://api.dicebear.com/8.x/identicon/svg?seed=Player1" /><span id="nickR">Player 1</span></span>
      <span id="avatarYWrap"><img id="avatarY" class="c4-avatar" src="https://api.dicebear.com/8.x/identicon/svg?seed=Player2" /><span id="nickY">Player 2</span></span>
    </div>
    <div class="c4-board" id="c4Board"></div>
    <div class="c4-controls-mobile" id="c4MobileControls">
      <div class="c4-controls-row">
        <button id="btnUpC4" aria-label="Yuxarƒ±">‚¨ÜÔ∏è</button>
      </div>
      <div class="c4-controls-row">
        <button id="btnLeftC4" aria-label="Sol">‚¨ÖÔ∏è</button>
        <button id="btnDropC4" aria-label="A≈üaƒüƒ±">‚è¨</button>
        <button id="btnRightC4" aria-label="Saƒü">‚û°Ô∏è</button>
      </div>
      <div class="c4-controls-row">
        <button id="btnDownC4" aria-label="A≈üaƒüƒ±">‚¨áÔ∏è</button>
      </div>
      <div class="c4-controls-row" style="margin-top:6px;">
        <button id="btnFS" class="c4-fullscreen-btn" aria-label="Tam ekran rejimi" style="width:auto;max-width:160px;">‚õ∂</button>
      </div>
    </div>
    <div class="c4-status" id="c4Status"></div>
    <button class="c4-btn" onclick="c4Reset()"
      id="btnRestart">Yenid…ôn ba≈üla</button>
    <a href="../oyunlar.html" class="c4-btn" style="background:#222; color:#fff; margin-top:12px;">‚Üê Oyunlara qayƒ±t</a>
  </main>
  <footer class="footer"><p>¬© 2025 Sultan. Neon Group Azerbaijan</p></footer>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // ====== i18n ======
    const LANGS = {
      az: {
        connect4: "Connect Four",
        pvp: "2 n…ôf…ôr",
        ai: "NEON AI",
        turnR: "Qƒ±rmƒ±zƒ± n√∂vb…ôd…ô",
        turnY: "Sarƒ± n√∂vb…ôd…ô",
        yourTurn: "S…ônin n√∂vb…ôn",
        aiThinking: "NEON AI d√º≈ü√ºn√ºr...",
        redWin: "Qƒ±rmƒ±zƒ± qalib oldu!",
        yellowWin: "Sarƒ± qalib oldu!",
        aiWin: "NEON AI qalib oldu!",
        tie: "He√ß-he√ß…ô!",
        restart: "Yenid…ôn ba≈üla",
        screenshot: "üì∏"
      },
      ru: {
        connect4: "–ß–µ—Ç—ã—Ä–µ –≤ —Ä—è–¥",
        pvp: "2 –∏–≥—Ä–æ–∫–∞",
        ai: "NEON AI",
        turnR: "–•–æ–¥ –∫—Ä–∞—Å–Ω—ã—Ö",
        turnY: "–•–æ–¥ –∂—ë–ª—Ç—ã—Ö",
        yourTurn: "–¢–≤–æ–π —Ö–æ–¥",
        aiThinking: "NEON AI –¥—É–º–∞–µ—Ç...",
        redWin: "–ü–æ–±–µ–¥–∞ –∫—Ä–∞—Å–Ω—ã—Ö!",
        yellowWin: "–ü–æ–±–µ–¥–∞ –∂—ë–ª—Ç—ã—Ö!",
        aiWin: "NEON AI –ø–æ–±–µ–¥–∏–ª!",
        tie: "–ù–∏—á—å—è!",
        restart: "–°—ã–≥—Ä–∞—Ç—å –µ—â—ë",
        screenshot: "üì∏"
      },
      en: {
        connect4: "Connect Four",
        pvp: "2 Players",
        ai: "NEON AI",
        turnR: "Red's turn",
        turnY: "Yellow's turn",
        yourTurn: "Your turn",
        aiThinking: "NEON AI is thinking...",
        redWin: "Red wins!",
        yellowWin: "Yellow wins!",
        aiWin: "NEON AI wins!",
        tie: "Draw!",
        restart: "Restart",
        screenshot: "üì∏"
      }
    };
    let lang = localStorage.getItem("c4lang") || "az";
    function setLang(l) {
      lang = l;
      localStorage.setItem("c4lang",l);
      document.querySelector(".c4-title").textContent = LANGS[lang].connect4;
      document.getElementById('c4PVP').textContent = LANGS[lang].pvp;
      document.getElementById('c4AI').textContent = LANGS[lang].ai;
      document.getElementById('btnRestart').textContent = LANGS[lang].restart;
      document.getElementById('btnScreenshot').textContent = LANGS[lang].screenshot;
      c4Render(); c4Status();
    }
    document.getElementById("langSelect").value = lang;
    document.getElementById("langSelect").onchange = (e) => setLang(e.target.value);

    // ====== Player avatars & names ======
    let c4Avatars = {
      r: localStorage.getItem("c4AvatarR") || "https://api.dicebear.com/8.x/identicon/svg?seed=Player1",
      y: localStorage.getItem("c4AvatarY") || "https://api.dicebear.com/8.x/identicon/svg?seed=Player2"
    };
    let c4Nicks = {
      r: localStorage.getItem("c4NickR") || "Player 1",
      y: localStorage.getItem("c4NickY") || "Player 2"
    };
    function updateAvatarsNicks() {
      document.getElementById('avatarR').src = c4Avatars.r;
      document.getElementById('avatarY').src = c4Avatars.y;
      document.getElementById('nickR').textContent = c4Nicks.r;
      document.getElementById('nickY').textContent = c4Nicks.y;
    }
    // –í—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ –Ω–∏–∫–∞
    document.getElementById('avatarR').onclick = () => chooseAvatar('r');
    document.getElementById('avatarY').onclick = () => chooseAvatar('y');
    document.getElementById('nickR').onclick = () => chooseNick('r');
    document.getElementById('nickY').onclick = () => chooseNick('y');
    function chooseAvatar(color) {
      let url = prompt(LANGS[lang].yourTurn + ": " + (color === "r" ? "üî¥" : "üü°") + "\nURL ≈ü…ôkli v…ô ya DiceBear", c4Avatars[color]);
      if (url) {
        c4Avatars[color] = url;
        localStorage.setItem("c4Avatar" + color.toUpperCase(), url);
        updateAvatarsNicks();
      }
    }
    function chooseNick(color) {
      let nick = prompt(LANGS[lang].yourTurn + ": " + (color === "r" ? "üî¥" : "üü°") + "\nAdƒ±nƒ±zƒ± yazƒ±n", c4Nicks[color]);
      if (nick) {
        c4Nicks[color] = nick;
        localStorage.setItem("c4Nick" + color.toUpperCase(), nick);
        updateAvatarsNicks();
      }
    }

    // ====== Game State ======
    let c4BoardArr, c4Turn, c4WinLine=[], c4Mode='pvp', c4AIThinking=false, c4Finished=false;
    let c4SelectedCol = 3, c4SelectedRow = 0;
    let c4ScoreR = Number(localStorage.getItem("c4ScoreR")||0), c4ScoreY = Number(localStorage.getItem("c4ScoreY")||0), c4LastDrop = null;
    let c4HintMode = localStorage.getItem("c4Hint") === "1";

    // --- Save/load localStorage progress
    function saveC4State() {
      localStorage.setItem("c4Board", JSON.stringify(c4BoardArr));
      localStorage.setItem("c4Turn", c4Turn);
      localStorage.setItem("c4WinLine", JSON.stringify(c4WinLine));
      localStorage.setItem("c4Mode", c4Mode);
      localStorage.setItem("c4ScoreR", c4ScoreR);
      localStorage.setItem("c4ScoreY", c4ScoreY);
      localStorage.setItem("c4SelectedCol", c4SelectedCol);
      localStorage.setItem("c4SelectedRow", c4SelectedRow);
    }
    function loadC4State() {
      if(localStorage.getItem("c4Board")){
        c4BoardArr = JSON.parse(localStorage.getItem("c4Board"));
        c4Turn = localStorage.getItem("c4Turn")||'r';
        c4WinLine = JSON.parse(localStorage.getItem("c4WinLine"))||[];
        c4Mode = localStorage.getItem("c4Mode")||'pvp';
        c4ScoreR = Number(localStorage.getItem("c4ScoreR")||0);
        c4ScoreY = Number(localStorage.getItem("c4ScoreY")||0);
        c4SelectedCol = Number(localStorage.getItem("c4SelectedCol")||3);
        c4SelectedRow = Number(localStorage.getItem("c4SelectedRow")||0);
        c4Finished = !!c4WinLine.length || c4BoardArr.every(row=>row.every(cell=>cell));
        c4AIThinking = false;
        setLang(lang);
        updateAvatarsNicks();
        c4Render(); c4Status(); c4UpdateScores();
        if(c4Mode==='ai' && c4Turn==='y' && !c4Finished) setTimeout(()=>{if(!c4Finished) c4AIMove();},500);
        return true;
      }
      return false;
    }

    function c4SetMode(m){
      c4Mode = m;
      document.getElementById('c4PVP').classList.toggle('active',m==='pvp');
      document.getElementById('c4AI').classList.toggle('active',m==='ai');
      c4Reset();
    }
    function c4Reset(){
      c4BoardArr = Array(6).fill().map(()=>Array(7).fill(null));
      c4Turn = 'r'; c4WinLine=[]; c4AIThinking=false; c4Finished=false;
      c4SelectedCol = 3; c4SelectedRow = 0; c4LastDrop = null;
      c4Render(); c4Status(); c4UpdateScores(); updateAvatarsNicks();
      saveC4State();
      if(c4Mode==='ai' && c4Turn==='y') setTimeout(()=>{if(!c4Finished) c4AIMove();},800);
    }
    function c4UpdateScores(){
      document.getElementById('c4ScoreR').textContent = `üî¥ ${c4ScoreR}`;
      document.getElementById('c4ScoreY').textContent = `üü° ${c4ScoreY}`;
      localStorage.setItem("c4ScoreR", c4ScoreR);
      localStorage.setItem("c4ScoreY", c4ScoreY);
    }
    function c4Render(){
      let html='';
      let hints = c4HintMode && !c4Finished ? getWinningMoves(c4Turn) : [];
      for(let y=0;y<6;y++)for(let x=0;x<7;x++){
        let v = c4BoardArr[y][x];
        let win = c4WinLine.some(([yy,xx])=>yy===y&&xx===x);
        let selected = (y===c4SelectedRow && x===c4SelectedCol) ? ' style="box-shadow:0 0 0 4px #fbbd23,0 7px 28px #0007;z-index:2;"' : '';
        html+=`<div class="c4-cell${win?' win':''}"${selected} onclick="c4CellClick(${x})">`;
        if(hints.some(([yy,xx])=>yy===y&&xx===x)){
          html += `<span class="c4-hint">‚≠ê</span>`;
        }
        if(v){
          let dropAnim = "";
          if(c4LastDrop && c4LastDrop.x===x && c4LastDrop.y===y && c4LastDrop.anim){
            dropAnim = `style="transform:translateY(-${(c4LastDrop.fromRow-y)*54}px);opacity:0;animation:c4-drop 0.38s cubic-bezier(.39,1.01,.19,1.02) 1;animation-fill-mode:forwards;"`;
            c4LastDrop = null;
          }
          html+=`<div class="c4-piece ${v}" ${dropAnim}></div>`;
        }
        html+=`</div>`;
      }
      document.getElementById('c4Board').innerHTML=html;
    }
    // CSS drop –∞–Ω–∏–º–∞—Ü–∏—è
    const styleAnim = document.createElement('style');
    styleAnim.innerHTML = `
      @keyframes c4-drop {
        0% {transform:translateY(-320px); opacity:0;}
        80% {transform:translateY(8px); opacity:1;}
        100% {transform:translateY(0); opacity:1;}
      }
    `;
    document.head.appendChild(styleAnim);

    function c4Status(){
      let status = "";
      if(c4WinLine.length) status = (c4Turn==='r'
          ? (c4Mode==='ai'?LANGS[lang].aiWin:LANGS[lang].yellowWin)
          : LANGS[lang].redWin);
      else if(c4BoardArr.every(row=>row.every(cell=>cell))) status = LANGS[lang].tie;
      else if(c4Mode==='ai') status = c4Turn==='r'?LANGS[lang].yourTurn:LANGS[lang].aiThinking;
      else status = (c4Turn==='r'?LANGS[lang].turnR:LANGS[lang].turnY);
      document.getElementById('c4Status').innerHTML = status;
    }

    function c4CellClick(col){
      if(c4Finished||c4AIThinking||(c4Mode==='ai'&&c4Turn==='y'))return;
      let yDrop = -1;
      for(let y=5;y>=0;y--)if(!c4BoardArr[y][col]){
        yDrop = y;
        break;
      }
      if(yDrop === -1) return;
      c4LastDrop = {x:col, y:yDrop, fromRow:0, anim:true};
      c4BoardArr[yDrop][col]=c4Turn;
      c4SelectedRow=yDrop;
      if(c4CheckWin(yDrop,col,c4Turn)){
        c4Finished=true;
        if(c4Turn==='r') c4ScoreR++;
        else c4ScoreY++;
        c4Render(); c4Status(); c4UpdateScores(); saveC4State(); return;
      }
      if(c4BoardArr.every(row=>row.every(cell=>cell))){ c4Render(); c4Status(); saveC4State(); return;}
      c4Turn = c4Turn==='r'?'y':'r';
      c4SelectedCol=3; c4SelectedRow=0;
      c4Render(); c4Status(); c4UpdateScores(); saveC4State();
      if(c4Mode==='ai' && c4Turn==='y') setTimeout(()=>{if(!c4Finished) c4AIMove();},800);
    }
    function c4CheckWin(y,x,p){
      let dirs=[[0,1],[1,0],[1,1],[1,-1]];
      for(let [dy,dx] of dirs){
        let line=[[y,x]];
        for(let d of [-1,1]){
          let ny=y,nx=x;
          while(1){
            ny+=dy*d; nx+=dx*d;
            if(ny<0||ny>=6||nx<0||nx>=7||c4BoardArr[ny][nx]!==p)break;
            line.push([ny,nx]);
          }
        }
        if(line.length>=4){c4WinLine=line;return true;}
      }
      return false;
    }
    function c4AIMove(){
      if(c4Finished) { c4AIThinking = false; return; }
      c4AIThinking=true;
      let choices = [];
      for(let x=0;x<7;x++)if(!c4BoardArr[0][x])choices.push(x);
      let col = null;
      for(let x of choices){
        let y = getAvailableRow(x);
        if(y!==-1){
          c4BoardArr[y][x]='y';
          if(c4CheckWin(y,x,'y')){col=x;}
          c4BoardArr[y][x]=null; c4WinLine=[];
          if(col!==null) break;
        }
      }
      if(col===null){
        for(let x of choices){
          let y = getAvailableRow(x);
          if(y!==-1){
            c4BoardArr[y][x]='r';
            if(c4CheckWin(y,x,'r')){col=x;}
            c4BoardArr[y][x]=null; c4WinLine=[];
            if(col!==null) break;
          }
        }
      }
      if(col===null){
        col = choices.includes(3)?3:choices[Math.floor(Math.random()*choices.length)];
      }
      setTimeout(()=>{
        if(!c4Finished) c4CellClick(col);
        c4AIThinking=false;
      },350+Math.random()*250);
    }
    function getAvailableRow(col){
      for(let y=5;y>=0;y--)if(!c4BoardArr[y][col])return y;
      return -1;
    }
    // --- –ü–æ–¥—Å–∫–∞–∑–∫–∏: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö —Ö–æ–¥–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–∞ p
    function getWinningMoves(p) {
      const moves = [];
      for(let x=0;x<7;x++){
        let y = getAvailableRow(x);
        if(y!==-1){
          c4BoardArr[y][x]=p;
          if(c4CheckWin(y,x,p)) moves.push([y,x]);
          c4BoardArr[y][x]=null; c4WinLine=[];
        }
      }
      return moves;
    }
    // --- –ì–µ–π–º–ø–∞–¥ + UX
    function setupMobileControls() {
      const left = document.getElementById('btnLeftC4');
      const right = document.getElementById('btnRightC4');
      const drop = document.getElementById('btnDropC4');
      const up   = document.getElementById('btnUpC4');
      const down = document.getElementById('btnDownC4');
      // pointerdown –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ
      left.addEventListener('pointerdown', ()=>{ c4SelectedCol = Math.max(0,c4SelectedCol-1); c4Render(); });
      right.addEventListener('pointerdown', ()=>{ c4SelectedCol = Math.min(6,c4SelectedCol+1); c4Render(); });
      up.addEventListener('pointerdown', ()=>{ c4SelectedRow = Math.max(0,c4SelectedRow-1); c4Render(); });
      down.addEventListener('pointerdown', ()=>{ c4SelectedRow = Math.min(5,c4SelectedRow+1); c4Render(); });
      drop.addEventListener('pointerdown', ()=>{ c4CellClick(c4SelectedCol); });
      // –ö–Ω–æ–ø–∫–∞ fullscreen
      const btnFS = document.getElementById('btnFS');
      btnFS.onclick = function() {
        const el = document.getElementById('c4Main');
        if (!document.fullscreenElement && el.requestFullscreen) {
          el.requestFullscreen();
          btnFS.textContent = '‚õ∂ √ßƒ±x';
        } else if (document.exitFullscreen) {
          document.exitFullscreen();
          btnFS.textContent = '‚õ∂';
        }
      };
      document.addEventListener('fullscreenchange', () => {
        const btn = document.getElementById('btnFS');
        if(document.fullscreenElement){
          btn.textContent = '‚õ∂ √ßƒ±x';
        } else {
          btn.textContent = '‚õ∂';
        }
      });
    }
    setupMobileControls();

    // --- –°–≤–∞–π–ø—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
    let touchStartX=0, touchStartY=0;
    document.getElementById('c4Board').addEventListener('touchstart', function(e){
      if(e.touches.length===1){
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }
    });
    document.getElementById('c4Board').addEventListener('touchend', function(e){
      if(e.changedTouches.length===1){
        let dx = e.changedTouches[0].clientX - touchStartX;
        let dy = e.changedTouches[0].clientY - touchStartY;
        if(Math.abs(dx)>30 && Math.abs(dx)>Math.abs(dy)){
          if(dx>0) { c4SelectedCol = Math.min(6,c4SelectedCol+1); c4Render(); }
          else { c4SelectedCol = Math.max(0,c4SelectedCol-1); c4Render(); }
        } else if(Math.abs(dy)>30 && Math.abs(dy)>Math.abs(dx)){
          if(dy>0) c4CellClick(c4SelectedCol);
          else { c4SelectedRow = Math.max(0,c4SelectedRow-1); c4Render(); }
        }
        // –°–≤–∞–π–ø –¥–ª–∏–Ω–Ω—ã–π –≤–Ω–∏–∑ ‚Äî fullscreen
        if(dy>70) document.getElementById('btnFS').click();
      }
    });

    // --- –°–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–±–µ–¥–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞
    document.getElementById('btnScreenshot').onclick = function() {
      html2canvas(document.getElementById('c4Board')).then(canvas => {
        const link = document.createElement('a');
        link.download = `connect4_${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
      });
    };

    // --- –¢—É—Ç–æ—Ä–∏–∞–ª (–æ–±—É—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
    if(!localStorage.getItem('c4TutorialDone')){
      setTimeout(()=>{
        alert("‚ú® Qaydalar: √ñz fi≈ükanƒ±zƒ± (r…ônginizi) sƒ±raya d√ºz ‚Äî 4 bir sƒ±rada!\n\nƒ∞dar…ô: Fi≈ükanƒ± atmaq √º√ß√ºn ‚è¨ d√ºym…ôsini basƒ±n v…ô ya ustund…ô klikl…ôyin.\n\nG√∂st…ôri≈ül…ôr √º√ß√ºn ‚≠ê d√ºym…ôsini aktivl…ô≈üdirin.\n\nUƒüurlar!");
        localStorage.setItem('c4TutorialDone','1');
      },600);
    }

    // --- –ü–æ–¥—Å–∫–∞–∑–∫–∏: —Ä–µ–∂–∏–º –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ –¥–æ–ª–≥–æ–º—É –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –¥–æ—Å–∫—É
    document.getElementById('c4Board').addEventListener('contextmenu', function(e){
      e.preventDefault();
      c4HintMode = !c4HintMode;
      localStorage.setItem("c4Hint", c4HintMode ? "1" : "0");
      c4Render();
    });

    // --- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    if(!loadC4State()){ c4Reset(); }
    setLang(lang);
    updateAvatarsNicks();
  </script>
</body>
</html>
